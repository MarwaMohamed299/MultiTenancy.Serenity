import{a as B,b as k}from"../../../_chunks/chunk-GJWLMKGC.js";import{a as g,c as T}from"../../../_chunks/chunk-TK35OQTZ.js";import{g as S,j as b,k as I,l as h,m as s,n as P}from"../../../_chunks/chunk-L3EIMX6H.js";import"../../../_chunks/chunk-IHLQ5LPA.js";import{c as i,f as d,g as u,h as c,i as f,j as p}from"../../../_chunks/chunk-7V7WNOD5.js";var L=d(p(),1);var D=d(p(),1),A=d(p(),1);var t=d(p(),1);var r=d(p(),1);var C=class C extends r.BaseDialog{constructor(o){super(o),this.permissions=new k({element:this.byId("Permissions"),showRevoke:!0}),h.List({UserID:this.options.userID},e=>{this.permissions.value=e.Entities}),h.ListRolePermissions({UserID:this.options.userID},e=>{this.permissions.rolePermissions=e.Entities}),this.permissions.implicitPermissions=(0,r.getRemoteData)(B.Administration.ImplicitPermissions),this.dialogTitle=(0,r.stringFormat)((0,r.localText)("Site.UserPermissionDialog.DialogTitle"),this.options.username)}getDialogButtons(){return[{text:(0,r.localText)("Dialogs.OkButton"),cssClass:"btn btn-primary",click:i(o=>{h.Update({UserID:this.options.userID,Permissions:this.permissions.value},()=>{this.dialogClose(),window.setTimeout(()=>(0,r.notifySuccess)((0,r.localText)("Site.UserPermissionDialog.SaveSuccess")),0)})},"click")},{text:(0,r.localText)("Dialogs.CancelButton"),click:i(()=>this.dialogClose(),"click")}]}renderContents(){let o=this.useIdPrefix();return T("div",{id:o.Permissions})}};i(C,"UserPermissionDialog");var y=C;var E,x,q;E=[t.Decorators.registerClass("StartSharp.Administration.UserDialog")];var a=class a extends(q=t.EntityDialog){constructor(e){super(e);this.form=new I(this.idPrefix);this.form.Password.change(()=>{t.EditorUtils.setRequired(this.form.PasswordConfirm,this.form.Password.value.length>0)}),this.form.Password.addValidationRule(this.uniqueName,n=>{if(this.form.Password.value.length<6)return(0,t.stringFormat)((0,t.localText)(g.Validation.MinRequiredPasswordLength),6)}),this.form.PasswordConfirm.addValidationRule(this.uniqueName,n=>{if(this.form.Password.value!=this.form.PasswordConfirm.value)return(0,t.localText)(g.Validation.PasswordConfirmMismatch)})}getFormKey(){return I.formKey}getIdProperty(){return s.idProperty}getIsActiveProperty(){return s.isActiveProperty}getLocalTextPrefix(){return s.localTextPrefix}getNameProperty(){return s.nameProperty}getService(){return P.baseUrl}getToolbarButtons(){let e=super.getToolbarButtons();return e.push({title:(0,t.localText)(g.Site.UserDialog.EditPermissionsButton),cssClass:"edit-permissions-button",icon:"fa-lock text-green",onClick:i(()=>{new y({userID:this.entity.UserId,username:this.entity.Username}).dialogOpen()},"onClick")}),e}updateInterface(){super.updateInterface(),this.toolbar.findButton("edit-permissions-button").toggleClass("disabled",this.isNewOrDeleted())}afterLoadEntity(){super.afterLoadEntity(),this.form.Password.element.toggleClass("required",this.isNew()).closest(".field").findFirst("sup").toggle(this.isNew()),this.form.PasswordConfirm.element.toggleClass("required",this.isNew()).closest(".field").findFirst("sup").toggle(this.isNew())}getPropertyItems(){var e=super.getPropertyItems();return t.Authorization.hasPermission("Administration:Tenants")||(e=e.filter(n=>n.name!=s.Fields.TenantId)),e}};x=u(q),a=f(x,0,"UserDialog",E,a),i(a,"UserDialog"),c(x,1,a);var v=a;var F,R,O;F=[D.Decorators.registerClass()];var l=class l extends(O=D.EntityGrid){getColumnsKey(){return b.columnsKey}getDialogType(){return v}getIdProperty(){return s.idProperty}getIsActiveProperty(){return s.isActiveProperty}getLocalTextPrefix(){return s.localTextPrefix}getService(){return P.baseUrl}constructor(o){super(o)}getDefaultSortBy(){return[s.Fields.Username]}createIncludeDeletedButton(){}getColumns(){var o=super.getColumns(),e=(0,A.tryFirst)(o,m=>m.field==s.Fields.Roles);if(e){var n;S.getLookupAsync().then(m=>{n=m,this.slickGrid.invalidate()}),e.format=m=>{if(!n)return'<i class="fa fa-spinner"></i>';var U=(m.value||[]).map(N=>(n.itemById[N]||{}).RoleName||"");return U.sort(),U.join(", ")}}return o}};R=u(O),l=f(R,0,"UserGrid",F,l),i(l,"UserGrid"),c(R,1,l);var w=l;var se=i(()=>(0,L.gridPageInit)(w),"default");export{se as default};
//# sourceMappingURL=UserPage.js.map
